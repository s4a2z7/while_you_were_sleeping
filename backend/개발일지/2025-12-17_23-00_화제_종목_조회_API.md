# í™”ì œ ì¢…ëª© ì¡°íšŒ API êµ¬í˜„ ì™„ë£Œ

**ì‘ì„±ì¼**: 2025-12-17  
**ì‘ì—…**: í™”ì œ ì¢…ëª© ì¡°íšŒ API êµ¬í˜„ (ì¢…ëª© ì •ë³´ + ê´€ë ¨ ë‰´ìŠ¤ í†µí•©)

## ğŸ“‹ êµ¬í˜„ ê°œìš”

í™”ì œ ì¢…ëª© ì¡°íšŒ APIë¥¼ ì™„ì„±í–ˆìŠµë‹ˆë‹¤. StockServiceì™€ NewsServiceë¥¼ í†µí•©í•˜ì—¬ ë‹¨ì¼ API í˜¸ì¶œë¡œ ì¢…ëª© ì •ë³´ì™€ ê´€ë ¨ ë‰´ìŠ¤ë¥¼ í•¨ê»˜ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## âœ… êµ¬í˜„ ì‚¬í•­

### 1. API ëª…ì„¸ ì¶©ì¡±

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… | ìƒíƒœ |
|-----------|--------|------|------|
| `/api/stocks/trending` | GET | í™”ì œ ì¢…ëª© ì¡°íšŒ (ìƒìœ„ 1ê°œ + ê´€ë ¨ ë‰´ìŠ¤) | âœ… ì™„ë£Œ |
| `/api/stocks/{ticker}` | GET | ì¢…ëª© ìƒì„¸ ì •ë³´ (ì¢…ëª©ì •ë³´ + ê´€ë ¨ ë‰´ìŠ¤) | âœ… ì™„ë£Œ |

### 2. ì£¼ìš” ê¸°ëŠ¥

#### GET /api/stocks/trending
- **Query íŒŒë¼ë¯¸í„°**: `screener_type` (most_actives, day_gainers, day_losers)
- **ë™ì‘**:
  1. StockServiceì—ì„œ í•´ë‹¹ screener_typeì˜ TOP 1 ì¢…ëª© ì¡°íšŒ
  2. NewsServiceì—ì„œ í•´ë‹¹ ì¢…ëª©ì˜ ìµœê·¼ 5ê°œ ë‰´ìŠ¤ ê²€ìƒ‰
  3. ì¢…ëª© ì •ë³´ + ë‰´ìŠ¤ë¥¼ í†µí•©í•˜ì—¬ ë°˜í™˜

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "status": "success",
  "screener_type": "most_actives",
  "top_stock": {
    "ticker": "NVDA",
    "name": "NVIDIA Corporation",
    "price": 135.45,
    "change_percent": 2.5,
    "volume": 45000000,
    "market_cap": "3.3T",
    "sector": "Technology",
    "industry": "Semiconductors",
    "pe_ratio": "65.2",
    "news": [
      {
        "title": "NVIDIA Reports Strong Q4 Earnings",
        "summary": "NVIDIA exceeded analyst expectations...",
        "source": "Exa",
        "url": "https://example.com/news/1",
        "published_at": "2025-12-17T10:30:00",
        "related_tickers": ["NVDA"]
      }
    ]
  }
}
```

#### GET /api/stocks/{ticker}
- **ê²½ë¡œ íŒŒë¼ë¯¸í„°**: `ticker` (ì¢…ëª© ì½”ë“œ)
- **ë™ì‘**:
  1. StockServiceì—ì„œ í•´ë‹¹ ì¢…ëª©ì˜ ìƒì„¸ ì •ë³´ ì¡°íšŒ
  2. NewsServiceì—ì„œ í•´ë‹¹ ì¢…ëª©ì˜ ìµœê·¼ 5ê°œ ë‰´ìŠ¤ ê²€ìƒ‰
  3. ì¢…ëª© ì •ë³´ + ë‰´ìŠ¤ë¥¼ í†µí•©í•˜ì—¬ ë°˜í™˜

### 3. Pydantic ëª¨ë¸ (schemas.py)

ìƒˆë¡œìš´ ì‘ë‹µ ëª¨ë¸ ì¶”ê°€:
```python
class TrendingStockDetail(BaseModel):
    """í™”ì œ ì¢…ëª© ìƒì„¸ ì •ë³´ (ë‰´ìŠ¤ í¬í•¨)"""
    ticker: str
    name: str
    price: float
    change_percent: float
    volume: int
    market_cap: Optional[str]
    sector: Optional[str]
    industry: Optional[str]
    pe_ratio: Optional[str]
    news: List[NewsItem]

class StockDetailResponse(BaseModel):
    """ì¢…ëª© ìƒì„¸ ì •ë³´ ì‘ë‹µ (ë‰´ìŠ¤ í¬í•¨)"""
    # TrendingStockDetailê³¼ ë™ì¼
```

### 4. ì—ëŸ¬ ì²˜ë¦¬

ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì—ì„œ HTTPExceptionìœ¼ë¡œ ì—ëŸ¬ ì²˜ë¦¬:
- ì¢…ëª© ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨ â†’ 400 Bad Request
- ë‰´ìŠ¤ ì¡°íšŒ ì‹¤íŒ¨ â†’ ë¹ˆ ë°°ì—´ë¡œ ì•ˆì „ ì²˜ë¦¬ (API ì˜¤ë¥˜ ë¬´ì‹œ)

### 5. CORS ì„¤ì •

`main.py`ì—ì„œ ì´ë¯¸ ì„¤ì •ë¨:
```python
allowed_origins = [
    "http://localhost:3000",
    "http://localhost:3001",
    "https://localhost:3000",
]
```

## ğŸ”„ í†µí•© ë¡œì§

### ì¢…ëª© ì •ë³´ì™€ ë‰´ìŠ¤ í†µí•© í”„ë¡œì„¸ìŠ¤

```
1. API ìš”ì²­ ìˆ˜ì‹ 
   â”œâ”€ GET /api/stocks/trending?screener_type=most_actives
   â””â”€ GET /api/stocks/AAPL

2. ì¢…ëª© ì •ë³´ ì¡°íšŒ (StockService)
   â”œâ”€ Screener.get_screeners(screener_type)
   â””â”€ Ticker(ticker_symbol).asset_profile, summary_detail

3. ë‰´ìŠ¤ ì •ë³´ ì¡°íšŒ (NewsService)
   â””â”€ Exa API: í•´ë‹¹ ì¢…ëª©ì˜ ìµœê·¼ 24ì‹œê°„ ë‰´ìŠ¤

4. DateTime ë³€í™˜ ë° Pydantic ëª¨ë¸ ìƒì„±
   â”œâ”€ published_date ë¬¸ìì—´ â†’ datetime ë³€í™˜
   â””â”€ NewsItem ê°ì²´ ìƒì„±

5. í†µí•© ì‘ë‹µ ë°˜í™˜
   â””â”€ {ì¢…ëª©ì •ë³´, ë‰´ìŠ¤: [ë‰´ìŠ¤1, ë‰´ìŠ¤2, ...]}
```

### DateTime ì²˜ë¦¬

ë‰´ìŠ¤ APIì˜ `published_date` (ISO í˜•ì‹ ë¬¸ìì—´)ì„ `NewsItem.published_at` (datetime)ë¡œ ë³€í™˜:
- ISO 8601 í˜•ì‹ íŒŒì‹± (Z ì œê±° í›„ ë³€í™˜)
- íŒŒì‹± ì‹¤íŒ¨ ì‹œ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ê¸°ë³¸ê°’ ì„¤ì •

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼

### 1. `api/stocks.py` (ë©”ì¸ ë³€ê²½)
- Import: `NewsService`, `NewsItem` ì¶”ê°€
- datetime import ì¶”ê°€
- ë‘ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ NewsService í˜¸ì¶œ ë¡œì§ ì¶”ê°€
- DateTime ë³€í™˜ ë° ë‰´ìŠ¤ ë¦¬ìŠ¤íŠ¸ ìƒì„±

### 2. `models/schemas.py`
- `TrendingStockDetail` ëª¨ë¸ ì¶”ê°€ (ë‰´ìŠ¤ í¬í•¨)
- `StockDetailResponse` ëª¨ë¸ ì¶”ê°€

### 3. `main.py`
- ê¸°ì¡´ ì„¤ì • ìœ ì§€ (CORS, ë¼ìš°í„° ë“±ë¡)

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

**í…ŒìŠ¤íŠ¸ íŒŒì¼**: `test_api.py`

```
âœ“ most_actives ì¡°íšŒ ì„±ê³µ
  - ìƒíƒœ: success
  - ì¢…ëª©: NVDA
  - ë‰´ìŠ¤: 0ê°œ (Exa API í‚¤ ë¯¸ì„¤ì •ìœ¼ë¡œ ë‰´ìŠ¤ ë¯¸ì¡°íšŒ)

âœ“ AAPL ì¡°íšŒ ì„±ê³µ
  - ìƒíƒœ: success
  - ì¢…ëª©: AAPL
  - ë‰´ìŠ¤: 0ê°œ (Exa API í‚¤ ë¯¸ì„¤ì •ìœ¼ë¡œ ë‰´ìŠ¤ ë¯¸ì¡°íšŒ)
```

**ì„œë²„ ìƒíƒœ**: âœ… ì •ìƒ ìš´ì˜ ì¤‘
- í¬íŠ¸: 8000
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## âš™ï¸ ê¸°ìˆ  ìŠ¤íƒ

- **í”„ë ˆì„ì›Œí¬**: FastAPI + Uvicorn
- **ë°ì´í„°**: yahooquery (ì¢…ëª©ì •ë³´), Exa API (ë‰´ìŠ¤)
- **ê²€ì¦**: Pydantic v2
- **ë¹„ë™ê¸°**: asyncio

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### ìš°ì„ ìˆœìœ„ 1: Exa API í‚¤ ì„¤ì •
```bash
# .env íŒŒì¼ì— ì¶”ê°€
EXA_API_KEY=your_exa_api_key_here
```

### ìš°ì„ ìˆœìœ„ 2: ë‰´ìŠ¤ ìš”ì•½ ì¶”ê°€ (Gemini API)
- NewsServiceì— `summarize_news()` ë©”ì„œë“œ ì¶”ê°€
- ë‰´ìŠ¤ ìš”ì•½ì„ responseì— í¬í•¨

### ìš°ì„ ìˆœìœ„ 3: ë¸Œë¦¬í•‘ ìƒì„± ì„œë¹„ìŠ¤
- `BriefingService` êµ¬í˜„
- ì¢…ëª© + ë‰´ìŠ¤ + ìš”ì•½ì„ ì¡°í•©í•œ ì¼ì¼ ë¸Œë¦¬í•‘ ìƒì„±

### ìš°ì„ ìˆœìœ„ 4: í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™
- Next.jsì—ì„œ API í˜¸ì¶œ
- í™”ë©´ êµ¬ì„±: ì¢…ëª© ì¹´ë“œ + ë‰´ìŠ¤ í”¼ë“œ

## ğŸ“ API ì‚¬ìš© ì˜ˆì‹œ

### cURL
```bash
# í™”ì œ ì¢…ëª© ì¡°íšŒ
curl "http://localhost:8000/api/stocks/trending?screener_type=most_actives"

# ì¢…ëª© ìƒì„¸ ì •ë³´
curl "http://localhost:8000/api/stocks/AAPL"
```

### Python
```python
import httpx

async with httpx.AsyncClient() as client:
    # í™”ì œ ì¢…ëª©
    resp = await client.get(
        "http://localhost:8000/api/stocks/trending",
        params={"screener_type": "most_actives"}
    )
    data = resp.json()
    
    # ì¢…ëª© ìƒì„¸
    resp = await client.get("http://localhost:8000/api/stocks/AAPL")
    data = resp.json()
```

## ğŸ“Š ì‘ë‹µ êµ¬ì¡°

```
{
  "status": "success|error",
  "screener_type": "most_actives|day_gainers|day_losers" (trendingë§Œ),
  "ticker": "AAPL",  (/{ticker}ë§Œ),
  "top_stock": {  (trendingë§Œ),
    "ticker": "NVDA",
    "name": "...",
    "price": 135.45,
    "change_percent": 2.5,
    "volume": 45000000,
    "market_cap": "3.3T",
    "sector": "Technology",
    "industry": "Semiconductors",
    "pe_ratio": "65.2",
    "news": [
      {
        "title": "...",
        "summary": "...",
        "source": "Exa",
        "url": "...",
        "published_at": "2025-12-17T10:30:00",
        "related_tickers": ["NVDA"]
      }
    ]
  },
  "news": [...]  (/{ticker}ë§Œ),
  "message": "ì—ëŸ¬ ë©”ì‹œì§€" (error ìƒíƒœì¼ ë•Œ)
}
```

---

**ìƒíƒœ**: âœ… ì™„ë£Œ  
**í…ŒìŠ¤íŠ¸**: âœ… í†µê³¼  
**ë°°í¬ ì¤€ë¹„**: â³ Exa API í‚¤ ì„¤ì • í•„ìš”
